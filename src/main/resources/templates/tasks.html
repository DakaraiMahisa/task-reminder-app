<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>All Tasks</title>

    <link rel="stylesheet" th:href="@{/css/tasks.css}">

</head>
<body>

<h2>Task List</h2>
<!-- SUCCESS MESSAGE -->
<div th:if="${successMessage}" class="success-message"
     th:text="${successMessage}"></div>

<!-- ERROR MESSAGE -->
<div th:if="${errorMessage}" class="error-message"
     th:text="${errorMessage}"></div>
<!-- FILTER + SORT FORM -->
<form method="get" action="/api/tasks"
      style="margin-bottom: 20px; background: white; padding: 15px;
             border-radius: 8px; box-shadow: 0 2px 6px rgba(0,0,0,0.1);">

    <div style="display: flex; gap: 20px; align-items: center; flex-wrap: wrap;">

        <!-- Status Filter -->
        <div>
            <label>Status:</label>
            <select name="status">
                <option value="">All</option>
                <option value="PENDING" th:selected="${status == 'PENDING'}">Pending</option>
                <option value="IN_PROGRESS" th:selected="${status == 'IN_PROGRESS'}">In Progress</option>
                <option value="DONE" th:selected="${status == 'DONE'}">Done</option>
            </select>
        </div>

        <!-- Priority Filter -->
        <div>
            <label>Priority:</label>
            <select name="priority">
                <option value="">All</option>
                <option value="LOW" th:selected="${priority == 'LOW'}">Low</option>
                <option value="MEDIUM" th:selected="${priority == 'MEDIUM'}">Medium</option>
                <option value="HIGH" th:selected="${priority == 'HIGH'}">High</option>
            </select>
        </div>

        <!-- Search Title -->
        <div>
            <label>Title:</label>
            <input type="text" name="title" th:value="${title}" placeholder="Search title">
        </div>

        <!-- Sort By -->
        <div>
            <label>Sort By:</label>
            <select name="sortBy">
                <option value="dueDate" th:selected="${sortBy == 'dueDate'}">Due Date</option>
                <option value="priority" th:selected="${sortBy == 'priority'}">Priority</option>
                <option value="title" th:selected="${sortBy == 'title'}">Title</option>
            </select>
        </div>

        <!-- Apply Filters -->
        <button type="submit"
                style="background: #007bff; color: white; padding: 8px 12px;
                       border: none; border-radius: 5px; cursor: pointer;">
            Apply Filters
        </button>

        <!-- Clear Filters -->
        <a href="/api/tasks"
           style="background: #6c757d; color: white; padding: 8px 12px;
                  border-radius: 5px; text-decoration: none;">
            Clear Filters
        </a>

    </div>
</form>

<table>
    <thead>
    <tr>
        <th>ID</th>
        <th>Title</th>
        <th>Description</th>
        <th>Due Date</th>
        <th>Status</th>
        <th>Priority</th>
        <th>Created At</th>
        <th>Completed At</th>
        <th>Actions</th>
    </tr>
    </thead>

    <tbody>
    <tr th:each="task : ${tasks}">
        <td th:text="${task.id}"></td>
        <td th:text="${task.title}"></td>
        <td th:text="${task.description}"></td>
        <td th:text="${task.dueDate}"></td>
        <td th:text="${task.status.label}"></td>
        <td th:text="${task.priority.label}"></td>
        <td th:text="${#temporals.format(task.createdAt, 'yyyy-MM-dd')}"></td>
        <td th:text="${task.completedAt != null
        ? #temporals.format(task.completedAt, 'yyyy-MM-dd')
        : '-'}">
        </td>

        <td>
            <a class="button"
               th:href="@{/api/view/{id}(id=${task.id})}">
                View
            </a>
            <a class="button"
               th:href="@{/api/tasks/update/{id}(id=${task.id})}">
                Edit
            </a>

            <a class="button delete"
               th:href="@{/api/tasks/delete/{id}(id=${task.id})}"
               onclick="return confirm('Are you sure you want to delete this task?');">
                Delete
            </a>

            <a class="button"
               style="background: #17a2b8;"
               th:if="${task.status!=T(com.taskreminder.app.enums.TaskStatus).DONE}"
               th:href="@{/api/tasks/mark-done/{id}(id=${task.id})}">
                Mark Done
            </a>

        </td>
    </tr>
    </tbody>
</table>
</table>

<!--PAGINATION -->
<div class="pagination" th:if="${totalPages > 1}"
     style="margin-top: 20px; display: flex; gap: 15px; align-items: center; justify-content: center;">

    <!-- Previous -->
    <a class="button"
       th:if="${currentPage > 0}"
       th:href="@{/api/tasks(
           page=${currentPage - 1},
           size=${size},
           status=${status},
           priority=${priority},
           title=${title},
           sortBy=${sortBy},
           sortDir=${sortDir}
       )}">
        Previous
    </a>

    <!-- Page Info -->
    <span>
        Page <strong th:text="${currentPage + 1}"></strong>
        of <strong th:text="${totalPages}"></strong>
    </span>

    <!-- Next -->
    <a class="button"
       th:if="${currentPage < totalPages - 1}"
       th:href="@{/api/tasks(
           page=${currentPage + 1},
           size=${size},
           status=${status},
           priority=${priority},
           title=${title},
           sortBy=${sortBy},
       )}">
        Next
    </a>
</div>
<a class="add-task" href="/api/tasks/add">+ Add New Task</a>
<footer class="footer">
    <div class="footer-content">
        <span>Task Reminder App</span>
        <span>&copy; 2025</span>
        <span>Created by Dakarai Mahisa</span>
    </div>
</footer>
</body>
</html>
