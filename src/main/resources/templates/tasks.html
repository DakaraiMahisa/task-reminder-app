<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="UTF-8">
    <title>All Tasks</title>

    <!-- Page-specific stylesheet -->
    <link rel="stylesheet" th:href="@{/css/tasks.css}">
</head>

<body>

<div class="page-container">
    <!-- =====================================================
    TOP NAVIGATION BAR
    ===================================================== -->
    <nav class="top-nav">
        <div class="nav-left">
            <span class="app-title">Task Reminder App</span>
        </div>

        <div class="nav-right">
            <a href="/api/tasks/add" class="nav-btn">
                + Add New Task
            </a>
        </div>
    </nav>

    <!-- =====================================================
         HEADER / PAGE INTRO
         ===================================================== -->
    <header class="page-header">
        <h2>Task List</h2>
    </header>


    <!-- =====================================================
         FEEDBACK / NOTIFICATIONS
         ===================================================== -->
    <section class="notifications">

        <!-- SUCCESS MESSAGE -->
        <div th:if="${successMessage}"
             class="success-message"
             th:text="${successMessage}">
        </div>

        <!-- ERROR MESSAGE -->
        <div th:if="${errorMessage}"
             class="error-message"
             th:text="${errorMessage}">
        </div>

    </section>


    <!-- =====================================================
         FILTER, SEARCH & SORT CONTROLS
         ===================================================== -->
    <section class="task-controls">

        <form method="get" action="/api/tasks" class="filter-form">

            <div class="filter-group">

                <!-- Status Filter -->
                <div class="filter-item">
                    <label>Status</label>
                    <select name="status">
                        <option value="">All</option>
                        <option value="PENDING" th:selected="${status == 'PENDING'}">Pending</option>
                        <option value="IN_PROGRESS" th:selected="${status == 'IN_PROGRESS'}">In Progress</option>
                        <option value="DONE" th:selected="${status == 'DONE'}">Done</option>
                    </select>
                </div>

                <!-- Priority Filter -->
                <div class="filter-item">
                    <label>Priority</label>
                    <select name="priority">
                        <option value="">All</option>
                        <option value="LOW" th:selected="${priority == 'LOW'}">Low</option>
                        <option value="MEDIUM" th:selected="${priority == 'MEDIUM'}">Medium</option>
                        <option value="HIGH" th:selected="${priority == 'HIGH'}">High</option>
                    </select>
                </div>

                <!-- Title Search -->
                <div class="filter-item">
                    <label>Title</label>
                    <input type="text"
                           name="title"
                           th:value="${title}"
                           placeholder="Search title">
                </div>

                <!-- Sort By -->
                <div class="filter-item">
                    <label>Sort By</label>
                    <select name="sortBy">
                        <option value="dueDate" th:selected="${sortBy == 'dueDate'}">Due Date</option>
                        <option value="priority" th:selected="${sortBy == 'priority'}">Priority</option>
                        <option value="title" th:selected="${sortBy == 'title'}">Title</option>
                    </select>
                </div>

                <!-- Actions -->
                <div class="filter-actions">
                    <button type="submit" class="btn btn-primary">
                        Apply Filters
                    </button>

                    <a href="/api/tasks" class="btn btn-secondary">
                        Clear Filters
                    </a>
                </div>

            </div>
        </form>

    </section>


    <!-- =====================================================
         MAIN CONTENT
         ===================================================== -->
    <main class="content">

        <!-- ===============================================
             TASK TABLE
             =============================================== -->
        <section class="task-list">

            <table class="task-table">
                <thead>
                <tr>
                    <th>ID</th>
                    <th>Title</th>
                    <th>Description</th>
                    <th>Due Date</th>
                    <th>Status</th>
                    <th>Priority</th>
                    <th>Created At</th>
                    <th>Completed At</th>
                    <th>Actions</th>
                </tr>
                </thead>

                <tbody>
                <tr th:each="task : ${tasks}">
                <td th:text="${task.id}"></td>
                    <td th:text="${task.title}"></td>
                    <td th:text="${task.description}"></td>
                    <td th:text="${task.dueDate}"></td>
                    <td>
    <span class="badge status"
          th:text="${task.status.label}"
          th:classappend="' status-' + ${task.status}">
    </span>
                    </td>

                    <td>
    <span class="badge priority"
          th:text="${task.priority.label}"
          th:classappend="' priority-' + ${task.priority}">
    </span>
                    </td>

                    <td th:text="${#temporals.format(task.createdAt, 'yyyy-MM-dd')}"></td>
                    <td th:text="${task.completedAt != null
                        ? #temporals.format(task.completedAt, 'yyyy-MM-dd')
                        : '-'}">
                    </td>

                    <td class="action-buttons">
                        <a class="btn"
                           th:href="@{/api/view/{id}(id=${task.id})}">
                            View
                        </a>

                        <a class="btn"
                           th:href="@{/api/tasks/update/{id}(id=${task.id})}">
                            Edit
                        </a>

                        <a class="btn btn-danger"
                           th:href="@{/api/tasks/delete/{id}(id=${task.id})}"
                           onclick="return confirm('Are you sure you want to delete this task?');">
                            Delete
                        </a>

                        <a class="btn btn-info"
                           th:if="${task.status != T(com.taskreminder.app.enums.TaskStatus).DONE}"
                           th:href="@{/api/tasks/mark-done/{id}(id=${task.id})}">
                            Mark Done
                        </a>
                    </td>
                </tr>
                </tbody>
            </table>

        </section>


        <!-- ===============================================
             PAGINATION
             =============================================== -->
        <section class="pagination-container"
                 th:if="${totalPages > 1}">

            <a class="btn"
               th:if="${currentPage > 0}"
               th:href="@{/api/tasks(
                   page=${currentPage - 1},
                   size=${size},
                   status=${status},
                   priority=${priority},
                   title=${title},
                   sortBy=${sortBy},
                   sortDir=${sortDir}
               )}">
                Previous
            </a>

            <span class="page-info">
                Page <strong th:text="${currentPage + 1}"></strong>
                of <strong th:text="${totalPages}"></strong>
            </span>

            <a class="btn"
               th:if="${currentPage < totalPages - 1}"
               th:href="@{/api/tasks(
                   page=${currentPage + 1},
                   size=${size},
                   status=${status},
                   priority=${priority},
                   title=${title},
                   sortBy=${sortBy}
               )}">
                Next
            </a>

        </section>

    </main>


    <!-- =====================================================
         FOOTER
         ===================================================== -->
    <footer class="footer">
        <div class="footer-content">
            <span>Task Reminder App</span>
            <span>&copy; 2025</span>
            <span>Created by Dakarai Mahisa</span>
        </div>
    </footer>

</div>

</body>
</html>
