<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Task Dashboard | Productivity Hub</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">

    <link rel="stylesheet" th:href="@{/css/common.css}">
    <link rel="stylesheet" th:href="@{/css/dashboard.css}">
    <link rel="stylesheet" th:href="@{/css/header.css}">
    <link rel="stylesheet" th:href="@{/css/sidebar.css}">
    <link rel="stylesheet" th:href="@{/css/footer.css}">
</head>
<body>
<div th:replace="~{fragments/header :: header('dashboard')}"></div>
<div class="app-layout">
    <aside th:replace="~{fragments/sidebar ::sidebar('dashboard')}"></aside>

<main class="dashboard-wrapper">
    <div class="container py-4">

        <div class="row mb-4">
            <div class="col-12">
                <h1 class="h3 fw-bold text-dark">System Statistics</h1>
                <p class="text-muted">Overview of task performance and status for <span th:text="${userName}" class="fw-bold text-primary">User</span>.</p>
            </div>
        </div>

        <div class="row g-4 mb-4">
            <div class="col-md-3">
                <div class="stat-card card-total">
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <span class="stat-label">Total Tasks</span>
                            <span class="stat-value" th:text="${stats.totalTasks}">0</span>
                        </div>
                        <div class="stat-icon-bg bg-primary-subtle text-primary">
                            <i class="fa-solid fa-list"></i>
                        </div>
                    </div>
                </div>
            </div>

            <div class="col-md-3">
                <div class="stat-card card-completed">
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <span class="stat-label">Completed</span>
                            <span class="stat-value text-success" th:text="${stats.completedTasks}">0</span>
                        </div>
                        <div class="stat-icon-bg bg-success-subtle text-success">
                            <i class="fa-solid fa-check-double"></i>
                        </div>
                    </div>
                </div>
            </div>

            <div class="col-md-3">
                <div class="stat-card card-pending">
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <span class="stat-label">Pending</span>
                            <span class="stat-value text-warning" th:text="${stats.pendingTasks}">0</span>
                        </div>
                        <div class="stat-icon-bg bg-warning-subtle text-warning">
                            <i class="fa-solid fa-clock-rotate-left"></i>
                        </div>
                    </div>
                </div>
            </div>

            <div class="col-md-3">
                <div class="stat-card card-overdue">
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <span class="stat-label">Overdue</span>
                            <span class="stat-value text-danger" th:text="${stats.overdueTasks}">0</span>
                        </div>
                        <div class="stat-icon-bg bg-danger-subtle text-danger">
                            <i class="fa-solid fa-circle-exclamation"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="row">
            <div class="col-12">
                <div class="chart-container">
                    <div class="chart-header d-flex justify-content-between align-items-center mb-4">
                        <div>
                            <h5 class="fw-bold mb-0">Performance Trend</h5>
                            <small class="text-muted">Visual representation of tasks completed daily</small>
                        </div>
                        <div class="dropdown">
                            <button class="btn btn-sm btn-outline-secondary dropdown-toggle" type="button">
                                Last 7 Days
                            </button>
                        </div>
                    </div>

                    <div class="chart-canvas-wrapper" style="position: relative; height: 350px;">
                        <canvas id="productivityChart"
                                th:attr="data-labels=${chartLabels}, data-values=${chartData}">
                        </canvas>
                    </div>
                </div>
            </div>
        </div>
        <div class="row mt-4">
            <div class="col-12">
                <div class="card border-0 shadow-sm rounded-4">
                    <div class="card-body p-4">
                        <div class="d-flex justify-content-between align-items-center mb-3">
                            <h5 class="fw-bold text-dark mb-0">Recent Activity</h5>
                            <a th:href="@{/api/tasks}" class="btn btn-link btn-sm text-decoration-none fw-bold">View All</a>
                        </div>
                        <div class="table-responsive">
                            <table class="table table-hover align-middle mb-0">
                                <thead class="table-light">
                                <tr>
                                    <th class="ps-3">Task Title</th>
                                    <th>Status</th>
                                    <th>Due Date</th>
                                    <th class="text-end pe-3">Action</th>
                                </tr>
                                </thead>
                                <tbody>
                                <tr th:each="task : ${recentTasks}">
                                    <td class="ps-3">
                                        <div class="fw-semibold text-dark" th:text="${task.title}">Design Mockup</div>
                                        <small class="text-muted" th:text="${#strings.abbreviate(task.description, 40)}">Brief description...</small>
                                    </td>
                                    <td>
                                        <span th:if="${task.status == 'COMPLETED'}" class="badge bg-success-subtle text-success border border-success-subtle">Completed</span>
                                        <span th:if="${task.status == 'PENDING'}" class="badge bg-warning-subtle text-warning border border-warning-subtle">Pending</span>
                                        <span th:if="${task.status == 'OVERDUE'}" class="badge bg-danger-subtle text-danger border border-danger-subtle">Overdue</span>
                                    </td>
                                    <td class="text-muted">
                                        <i class="fa-regular fa-calendar-days me-1"></i>
                                        <span th:text="${#temporals.format(task.dueDate, 'dd MMM yyyy, HH:mm')}">14 Jan 2026</span>
                                    </td>
                                    <td class="text-end pe-3">
                                        <a th:href="@{/api/tasks/update/{id}(id=${task.id})}" class="btn btn-sm btn-outline-primary rounded-pill px-3">
                                            Edit
                                        </a>
                                    </td>
                                </tr>
                                <tr th:if="${#lists.isEmpty(recentTasks)}">
                                    <td colspan="4" class="text-center py-4 text-muted">No recent activity found.</td>
                                </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</main>
</div>
<div th:replace="~{fragments/footer :: footer}"></div>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script th:src="@{/js/dashboard-charts.js}"></script>
<script src="/js/live-time.js"></script>
<script src="/js/header.js"></script>
</body>
</html>